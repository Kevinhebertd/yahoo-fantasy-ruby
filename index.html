<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: README
  
    &mdash; Documentation by YARD 0.9.27
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "README";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'><h1 id="yahoo-fantasy-ruby">Yahoo Fantasy (Ruby)</h1>

<p>Provides Ruby wrapping of the <a href="https://developer.yahoo.com/fantasysports/guide">Yahoo Fantasy Sports API</a>.</p>

<blockquote>
  <p>I make no guarantees about this code working or without some poor Ruby choices.</p>
</blockquote>

<p>This was my first attempt at a Ruby library (at Ruby at all to be honest) and may:</p>

<ul>
  <li>Not work at all - although that would be a failure of the adventure</li>
  <li>Come no where close to <strong>best practices</strong> with regards to designing Ruby libraries</li>
  <li>Need a lot of love in order to get to a <strong>realistic Ruby</strong> place</li>
</ul>

<blockquote>
  <p>If you come across this repo and you see anyting that I could have done better.  Please don’t hesitate to shoot me a note or a pull request (with some whys and whats of the changes) so that I can continue my Ruby journey on the right path!!</p>
</blockquote>

<h2 id="installation">Installation</h2>

<blockquote>
  <p>At this point in time the name <code>yahoo-fantasy</code> may change.   I guess the ruby part is a little superfluous, but it was the name of the folder I needed so I rolled with it.</p>
</blockquote>

<h3 id="gem">Gem</h3>

<p>Add this line to your application’s Gemfile:</p>

<p><code>ruby
gem 'yahoo-fantasy'
</code></p>

<h3 id="gemspec">Gemspec</h3>

<p>Add to your <code>gemspec</code>:</p>

<p><code>
spec.add_dependency "yahoo_fantasy_ruby"
</code></p>

<p>Then install dependencies:</p>

<p><code>
$ bundle install
</code></p>

<h3 id="install-directly">Install Directly</h3>

<p>Install the gem directly:</p>

<p><code>
$ gem install yahoo-fantasy
</code></p>

<h2 id="usage">Usage</h2>

<p>The library provides/allows for a number of different usage methods - or at least that was the goal.  You can pull and use as much or as little of as needed.</p>

<p>At this point in time the <code>client</code> and <code>resources</code> are tied to an <code>OAuth2::AccessToken</code> (or atleast some object that responds to the <code>#request</code> method).</p>

<h3 id="client">Client</h3>

<p>The <code>YahooFantasy::Client</code>, an extension of the <code>OAuth2::Client</code> providing sensible defaults and <code>Response</code> parsing is meant to be used.  Obviously this can be skipped if you’re using your own custom <code>client</code> or <code>access_token#request</code> during processing.</p>

<p>```
# Create a new access token using the 
# This can be created and maintained at the server level
client = YahooFantasy::Client.new(ENV[‘yf_client_id], ENV[‘yf_client_secret’], redirect_uri: ENV[‘webroot_url])</p>

<h1 id="the-access-token-is-created-at-the-request-level">The access token is created at the request level</h1>
<p># Once you’ve gotten your user from the session/re-login
access_token = OAuth2::AccessToken.from_hash(client, 
                                             access_token: token.token, 
                                             refresh_token: token.refresh_token, 
                                             expiry_time: token.expiry_time)
```</p>

<p>I chose to use the <code>OAuth2::Client</code> and <code>OAuth2::AccessToken</code> instead of creating and maintaining my own <code>connection</code> (Faraday or other) as the library and classes were already well designed and provided the backing I needed without much change.  There are other libraries out there that only required setting of <code>access_token</code> to work, but I felt it important to be able to:
- make calls
- handle refreshes
- etc</p>

<p>within the same <code>client</code> that the users were making for requests.</p>

<blockquote>
  <p>One interesting thing with Yahoo tokens is that the refresh token doesn’t update (from what I’ve seen).  For example the same <code>access_token</code> and <code>refresh_token</code> can be used to refresh and work.  You don’t need to save the new tokens to the database (although you probably should) you don’t need to.</p>
</blockquote>

<h3 id="resources">Resources</h3>

<p>Once you’ve got your <code>access_token</code> you supply the users token to the resources:</p>

<h4 id="base">Base</h4>

<p>The <code>YahooFantasy::Resource::Base</code> class provides access to the <code>access_token</code>:</p>

<p><code>
# With the access_token above
YahooFantasy::Resource::Base.access_token = access_token
</code></p>

<blockquote>
  <p>The <code>access_token</code> is stored at the <code>Thread[]</code> level so you need to ensure that it’s removed after the request (server based).  One of the next steps is providing the <code>Rails</code> specific classes to assist with this.</p>
</blockquote>

<p>Once the access token is provided, requests can be made through the <code>.api</code> method:</p>

<p><code>
fantasy_content = YahooFantasy::Resource::Base.api(:get, '/users;use_login=1/games/leagues)
fantasy_content.games.each do |game|
  puts "#{game.code.upcase}"                            # =&gt; NFL
  game.leagues.each do |league|
    puts "- #{league.name} (#{league.league_key})"      # =&gt; - League Name (404.l.12345)
  end 
end
</code></p>

<p>The <code>Base</code> resource also has methods:</p>

<ul>
  <li><code>.get(key, options, &amp;block)</code> to get a single resource</li>
  <li><code>.all(filters, options, &amp;block)</code> to get a collection of resources</li>
</ul>

<p>Which will attempt to create the appropriate resource url from the provided arguments (need some love and handling) and will return a <code>YahooFantasy::Resource::FantasyContent</code> or what is returned from the <code>-&gt;(fantasy_content) {}</code> block provided.</p>

<blockquote>
  <p>This is where it would make more sense to provide <code>YahooFantasy::Api::Resource</code> and <code>YahooFantasy::Api::Collection</code> as mentioned elsewhere in here.</p>
</blockquote>

<h4 id="games">Game(s)</h4>

<p>The <code>YahooFantasy::Resource::Game::Game</code> resource provides some consistent and common access to the API.</p>

<blockquote>
  <p>Ya, I get the name <code>Game::Game</code> isn’t optimal.  I’ve been playing around with the idea of <code>Game::Meta</code> (which is how Yahoo references it) or <code>Api::Game</code>.  I’ll leave that for future Ken once I start actually using it.</p>
</blockquote>

<blockquote>
  <p>Also available at <code>YahooFantasy::Games</code> shortcut.</p>
</blockquote>

<h5 id="resource">Resource</h5>

<p><a href="https://developer.yahoo.com/fantasysports/guide/#game-resource">Game Resource</a> details can be found on the Yahoo developer portal.</p>

<p>For the most part the only the <code>game_key</code> is required when making a request, but there are subresources available:</p>

<p><strong>Filters</strong></p>

<table>
  <thead>
    <tr>
      <th>Filter</th>
      <th>Filter Parameter values</th>
      <th>Usage</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>out</td>
      <td>Game subresources</td>
      <td><code>Game.get('406', out: %w[game_weeks])</code></td>
    </tr>
  </tbody>
</table>

<p><strong>Example(s)</strong></p>

<p><code>
# Get game 406 meta data
game = YahooFantasy::Resource::Game::Game.get('406')
</code></p>

<blockquote>
  <p>The teams subresource is not currently available</p>
</blockquote>

<blockquote>
  <p>The leagues subresource is available. BUT it’s only available in terms of the logged in user.  At this point there is no way to request a subresource with further filters.   Although I do plan on getting this working once I get more comfortable with Ruby.</p>
</blockquote>

<h5 id="collection">Collection</h5>

<p><a href="https://developer.yahoo.com/fantasysports/guide/#games-collection">Games collection</a> provides access to multiple games using a set of specified filters.</p>

<p><strong>Filters</strong></p>

<p>Collection filters are available on top of resource filters.</p>

<table>
  <thead>
    <tr>
      <th>Filter</th>
      <th>Filter Parameter values</th>
      <th>Usage</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>game_keys</td>
      <td> </td>
      <td><code>Games.all(filters: { game_keys: ['406'] })</code></td>
    </tr>
    <tr>
      <td>is_available</td>
      <td><code>1</code> or <code>0</code></td>
      <td><code>Games.all(filters: { is_available: 1 })</code></td>
    </tr>
    <tr>
      <td>game_types</td>
      <td><code>full,pickem-team,pickem-group,pickem-team-list</code></td>
      <td><code>Games.all(filters: { game_types: ['pickem-team'] })</code></td>
    </tr>
    <tr>
      <td>game_codes</td>
      <td>Any valid game code(s)</td>
      <td><code>Games.all(filters: { game_codes: ['nfl'] })</code></td>
    </tr>
    <tr>
      <td>seasons</td>
      <td>Any valid season(s)</td>
      <td><code>Games.all(filters: { seasons: [2020] })</code></td>
    </tr>
  </tbody>
</table>

<h4 id="leagues">Leagues</h4>

<h4 id="teams">Teams</h4>

<h2 id="xml">XML</h2>

<p>The decision to use XML over JSON was made due to how Yahoo serializes data.  Although people tend to dislike XML due to its verboseness (I know there’s a war on verbosity these days in development) the structure makes sense:</p>

<p>```</p>
<games>
    <leagues>
        <scoreboard></scoreboard>
    </leagues>
</games>
<p>```</p>

<p>where JSON is serialized as an array (0 based with the meta data):</p>

<p><code>
games: [
    0: {
        // this is meta
    },
    1: {
        // this is the first sub resource
        // standings
    },
    2: {
        // this is the second sub resource
        // scoreboard
    }
]
</code></p>

<p>which I just find annoying, and although it seems like the indices are based on the alphabetical name of the subresource, I still don’t want to deal with it.</p>

<blockquote>
  <p>Will definitely accept a pull request for the JSON representers allowing configuration between both XML or JSON</p>
</blockquote>

<h2 id="development">Development</h2>

<h3 id="development-container">Development Container</h3>

<p>Development is done within a <a href="https://code.visualstudio.com/docs/remote/containers">development container</a> that can easily be used within <strong>vscode</strong> (and possibly/eventually) (Github Codespaces)[https://github.com/features/codespaces]:</p>

<blockquote>
  <p>Should make a <code>docker-compose</code> file at some point, but that’s future Ken’s problem</p>
</blockquote>

<p>The <code>devcontainer</code> post install script is configured to run <code>bin/setup</code> (described below).</p>

<blockquote>
  <p>Note that when you first set this up, you may need to restart some of the plugins (solargraph, ruby test explorer, etc).   This is due to <code>bundle install</code> requiring <code>gemspec</code> requiring <code>YahooFantasy::VERSION</code>, but copying those files to the Image seems to go against the point of docker.  Not a huge deal, just remember to restart them using the command palette.</p>
</blockquote>

<h3 id="manual">Manual</h3>

<p>After checking out the repo, run <code>bin/setup</code> to install dependencies. Then, run <code>rake spec</code> to run the tests. You can also run <code>bin/console</code> for an interactive prompt that will allow you to experiment.</p>

<p>To install this gem onto your local machine, run <code>bundle exec rake install</code>. To release a new version, update the version number in <code>version.rb</code>, and then run <code>bundle exec rake release</code>, which will create a git tag for the version, push git commits and tags, and push the <code>.gem</code> file to <a href="https://rubygems.org">rubygems.org</a>.</p>

<h2 id="contributing">Contributing</h2>

<p>Bug reports and pull requests are welcome on GitHub at https://github.com/kenjdavidson/yahoo_fantasy-ruby. This project is intended to be a safe, welcoming space for collaboration, and contributors are expected to adhere to the <a href="http://contributor-covenant.org">Contributor Covenant</a> code of conduct.</p>

<h2 id="license">License</h2>

<p>The gem is available as open source under the terms of the <a href="https://opensource.org/licenses/MIT">MIT License</a>.</p>

<h2 id="code-of-conduct">Code of Conduct</h2>

<p>Everyone interacting in the YahooFantasy project’s codebases, issue trackers, chat rooms and mailing lists is expected to follow the <a href="https://github.com/kenjdavidson/yahoo_fantasy-ruby/blob/master/CODE_OF_CONDUCT.md">code of conduct</a>.</p>
</div></div>

      <div id="footer">
  Generated on Thu Dec  9 20:18:55 2021 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.27 (ruby-2.7.5).
</div>

    </div>
  </body>
</html>